<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>App Title â€” MathGems</title>

  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

  <!-- Inter Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Global Styles -->
  <link rel="stylesheet" href="/css/styles.css">
</head>

<body class="bg-gray-50 text-gray-800">

  <!-- NAVBAR -->
  <header class="bg-white shadow-sm">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <img src="/img/gem.svg" alt="MathGems logo" class="w-7 h-7">
        <span class="text-2xl font-bold">
          <span class="text-gray-900">Math</span><span class="text-blue-600">Gems</span>
        </span>
      </div>

      <!-- Desktop Nav -->
      <nav class="hidden md:flex space-x-6">
        <a href="/index.html" class="text-gray-700 hover:text-blue-600">Home</a>
        <a href="/topics.html" class="text-gray-700 hover:text-blue-600">Browse Topics</a>
      </nav>

      <!-- Mobile Menu Button -->
      <button id="menuBtn" class="md:hidden focus:outline-none">
        <svg class="w-7 h-7 text-gray-700" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </div>

    <!-- Mobile Menu Panel -->
    <nav id="mobileMenu"
         class="md:hidden hidden flex-col bg-white border-t border-gray-200 px-6 py-4 space-y-4">
      <a href="/index.html" class="block text-gray-700 hover:text-blue-600">Home</a>
      <a href="/topics.html" class="block text-gray-700 hover:text-blue-600">Browse Topics</a>
    </nav>
  </header>

  <!-- APP HEADER -->
  <section class="max-w-4xl mx-auto px-6 py-12 text-center">
    <h2 class="text-3xl font-bold mb-4">App Title</h2>
    <p class="text-gray-600 mb-8">A short description of what this app helps students explore.</p>

    <!-- Preview Image -->
    <img src="preview.jpg"
         alt="App preview"
         class="w-full rounded-xl shadow-lg mb-10">
  </section>

  <!-- APP CONTENT -->
  <section class="max-w-4xl mx-auto px-6 pb-16">
    <div class="bg-white rounded-xl shadow p-6">

      <!-- Replace this with your actual app -->
      <div class="w-full h-96 bg-gray-100 rounded-lg flex items-center justify-center text-gray-500">

              <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Quadratic Auditor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/roughjs@latest/bundled/rough.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Gochi+Hand&family=Patrick+Hand&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .handwritten { font-family: 'Patrick Hand', cursive; font-size: 1.5rem; color: #1e293b; }
        .sketch-font { font-family: 'Gochi Hand', cursive; }
        .paper-bg {
            background-color: #fff;
            background-image: linear-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 100% 2.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .step-row {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
            position: relative;
        }
        .step-row:hover { background-color: rgba(251, 191, 36, 0.1); }
        .red-pen { color: #dc2626; font-family: 'Gochi Hand', cursive; transform: rotate(-2deg); }
        .green-pen { color: #16a34a; font-family: 'Gochi Hand', cursive; transform: rotate(-2deg); }
        
        /* Stamp Animation */
        .stamp { opacity: 0; transform: scale(2) rotate(-15deg); transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .stamp.visible { opacity: 1; transform: scale(1) rotate(-15deg); }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">
    <div class="max-w-4xl mx-auto space-y-8">
        <!-- HEADER -->
        <div class="bg-slate-800 text-white p-6 rounded-xl shadow-lg flex justify-between items-center border-b-8 border-slate-600">
            <div>
                <h1 class="text-3xl font-bold sketch-font flex items-center gap-3">
                    <span class="text-4xl">ğŸ•µï¸â€â™‚ï¸</span> The Quadratic Auditor
                </h1>
                <p class="text-slate-400 text-sm font-bold mt-1">Department of Mathematical Accuracy</p>
            </div>
            <div class="flex gap-2">
                 <select id="langSelect" class="bg-slate-700 border-2 border-slate-500 text-white px-3 py-2 rounded sketch-font font-bold hover:bg-slate-600 focus:outline-none">
                    <option value="zh">Mandarin (ä¸­æ–‡)</option>
                    <option value="ko">Korean (í•œêµ­ì–´)</option>
                    <option value="ja">Japanese (æ—¥æœ¬èª)</option>
                    <option value="ms">Malay (Bahasa Melayu)</option>
                    <option value="id">Indonesian (Bahasa Indo)</option>
                </select>
                <div class="text-right bg-slate-700 px-4 py-2 rounded border-2 border-slate-500">
                    <div class="text-xs text-slate-400 uppercase tracking-widest">Score</div>
                    <div id="score-display" class="text-2xl font-black text-emerald-400">0/0</div>
                </div>
            </div>
        </div>

        <!-- MAIN WORKSPACE -->
        <div class="grid md:grid-cols-12 gap-6">
            
            <!-- EXAM PAPER -->
            <div class="md:col-span-8 relative">
                <!-- Clipboard Clip -->
                <div class="absolute -top-4 left-1/2 -translate-x-1/2 w-32 h-12 bg-slate-700 rounded-t-lg z-10 border-b-4 border-slate-500 shadow-md"></div>
                
                <div class="paper-bg min-h-[600px] p-8 pt-16 rounded-lg relative overflow-hidden" id="exam-paper">
                    <!-- Header Info -->
                    <div class="flex justify-between border-b-2 border-slate-800 pb-4 mb-6 handwritten text-base">
                        <span>Student: <span class="font-bold">Alex Algebra</span></span>
                        <span>Date: <span id="today-date">--</span></span>
                        <span>Topic: <span class="font-bold">Quadratic Formula</span></span>
                    </div>

                    <!-- The Problem -->
                    <div class="mb-6">
                        <span class="font-bold text-slate-500 uppercase text-xs tracking-widest block mb-1">Question 1:</span>
                        <div id="question-text" class="text-2xl font-bold text-slate-800 handwritten">
                            <!-- e.g. Solve 2x^2 + 5x - 3 = 0 -->
                        </div>
                    </div>

                    <!-- The Work (Steps) -->
                    <div id="work-steps" class="space-y-1 relative">
                        <!-- Steps injected here -->
                    </div>

                    <!-- Canvas Layer for Red Pen Marks -->
                    <canvas id="penCanvas" class="absolute top-0 left-0 w-full h-full pointer-events-none z-20"></canvas>

                    <!-- Stamps -->
                    <div id="stamp-approved" class="stamp absolute bottom-10 right-10 border-4 border-emerald-600 text-emerald-600 font-black text-4xl p-4 rounded uppercase tracking-widest opacity-0">
                        APPROVED
                    </div>
                    <div id="stamp-rejected" class="stamp absolute bottom-10 right-10 border-4 border-red-600 text-red-600 font-black text-4xl p-4 rounded uppercase tracking-widest opacity-0">
                        REJECTED
                    </div>
                </div>
            </div>

            <!-- EXAMINER CONTROLS -->
            <div class="md:col-span-4 space-y-6">
                <!-- Briefing -->
                <div class="bg-white p-6 rounded-xl border-4 border-slate-200 shadow-sm">
                    <h2 class="font-bold text-slate-800 mb-2 flex items-center gap-2">
                        <span>ğŸ“‹</span> <span data-i18n="instructions_title">Examiner Instructions</span>
                    </h2>
                    <ul class="text-sm text-slate-600 space-y-2 list-disc pl-4" data-i18n="instructions_list">
                        <li>Review the student's work step-by-step.</li>
                        <li>If you find an error, <strong>click the specific line</strong> to mark it red.</li>
                        <li>If the work is perfect, click the <strong>"Mark as Correct"</strong> button.</li>
                    </ul>
                </div>

                <!-- Action Panel -->
                <div class="bg-slate-800 p-6 rounded-xl border-4 border-slate-600 shadow-lg text-center">
                    <p id="feedback-msg" class="text-white font-bold sketch-font text-xl mb-4 min-h-[3rem] flex items-center justify-center">
                        Waiting for review...
                    </p>
                    
                    <button id="btn-perfect" class="w-full bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-bold py-3 px-4 rounded-lg shadow-[0_4px_0_#065f46] active:shadow-none active:translate-y-1 transition-all sketch-font text-xl mb-4">
                        âœ… No Errors (Mark Correct)
                    </button>

                    <button id="btn-next" class="w-full bg-slate-200 hover:bg-white text-slate-900 font-bold py-3 px-4 rounded-lg shadow-[0_4px_0_#94a3b8] active:shadow-none active:translate-y-1 transition-all sketch-font text-xl hidden">
                        Next Paper â¡ï¸
                    </button>
                </div>
                
                <!-- Hint/Explanation (Revealed after check) -->
                <div id="explanation-box" class="hidden bg-amber-50 border-l-4 border-amber-500 p-4 rounded shadow-sm">
                    <h3 class="font-bold text-amber-800 text-sm mb-1">Analysis:</h3>
                    <p id="explanation-text" class="text-sm text-amber-900"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- KATE X CONFIG ---
        function renderMath() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false}
                ],
                throwOnError: false
            });
        }

        // --- TRANSLATIONS ---
        const translations = {
            zh: {
                instructions_title: "Examiner Instructions (è€ƒå®˜é¡»çŸ¥)",
                instructions_list: `
                    <li>Review the student's work step-by-step. (é€æ­¥å®¡æŸ¥å­¦ç”Ÿä½œä¸šã€‚)</li>
                    <li>If you find an error, <strong>click the specific line</strong> to mark it red. (è‹¥å‘ç°é”™è¯¯ï¼Œç‚¹å‡»è¯¥è¡Œæ ‡è®°ã€‚)</li>
                    <li>If the work is perfect, click the <strong>"No Errors"</strong> button. (è‹¥æ— é”™è¯¯ï¼Œç‚¹å‡»â€œæ— é”™è¯¯â€æŒ‰é’®ã€‚)</li>
                `,
                btn_perfect: "âœ… No Errors (æ— é”™è¯¯)",
                btn_next: "Next Paper â¡ï¸ (ä¸‹ä¸€ä»½)",
                msg_wait: "Waiting for review... (ç­‰å¾…å®¡æŸ¥...)",
                msg_correct_spot: "Excellent Eye! You found the error. (å¥½çœ¼åŠ›ï¼ä½ å‘ç°äº†é”™è¯¯ã€‚)",
                msg_false_alarm: "False Alarm! That step is actually correct. (è™šæƒŠä¸€åœºï¼é‚£ä¸€æ­¥æ˜¯å¯¹çš„ã€‚)",
                msg_missed_error: "You missed an error! Look closely. (ä½ æ¼æ‰äº†ä¸€ä¸ªé”™è¯¯ï¼ä»”ç»†çœ‹ã€‚)",
                msg_actually_wrong: "Oops! There WAS an error on line {n}. (å“å‘€ï¼ç¬¬ {n} è¡Œç¡®å®æœ‰é”™ã€‚)",
                msg_perfect_job: "Correct! The work is perfect. (æ­£ç¡®ï¼ä½œä¸šå¾ˆå®Œç¾ã€‚)",
                err_b_sign: "Forgot to flip the sign of b ($ -b $). (å¿˜äº†æŠŠ b å˜å·ã€‚)",
                err_disc_sign: "Sign error in discriminant ($ -4ac $). (åˆ¤åˆ«å¼ç¬¦å·é”™è¯¯ã€‚)",
                err_denom: "Denominator should be $ 2a $, not just $ 2 $. (åˆ†æ¯åº”è¯¥æ˜¯ 2aï¼Œä¸ä»…ä»…æ˜¯ 2ã€‚)",
                err_sqrt: "Square root calculated incorrectly. (å¹³æ–¹æ ¹è®¡ç®—é”™è¯¯ã€‚)"
            },
            // ... (Other languages follow same pattern, keeping simplified for brevity in this response)
            ko: {
                instructions_title: "Examiner Instructions (ì±„ì ì ì§€ì¹¨)",
                instructions_list: `<li>ë‹¨ê³„ë³„ë¡œ í•™ìƒì˜ í’€ì´ë¥¼ ê²€í† í•˜ì„¸ìš”.</li><li>ì˜¤ë¥˜ë¥¼ ë°œê²¬í•˜ë©´ <strong>í•´ë‹¹ ì¤„ì„ í´ë¦­</strong>í•˜ì—¬ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í‘œì‹œí•˜ì„¸ìš”.</li><li>í’€ì´ê°€ ì™„ë²½í•˜ë©´ <strong>"No Errors"</strong> ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</li>`,
                btn_perfect: "âœ… No Errors (ì˜¤ë¥˜ ì—†ìŒ)",
                btn_next: "Next Paper â¡ï¸ (ë‹¤ìŒ)",
                msg_wait: "Waiting for review... (ê²€í†  ëŒ€ê¸° ì¤‘...)",
                msg_correct_spot: "Excellent Eye! (ì •í™•í•©ë‹ˆë‹¤!)",
                msg_false_alarm: "False Alarm! (ì˜¤í•´ì…ë‹ˆë‹¤! ê·¸ ë‹¨ê³„ëŠ” ë§ìŠµë‹ˆë‹¤.)",
                msg_missed_error: "Missed an error! (ì˜¤ë¥˜ë¥¼ ë†“ì³¤ìŠµë‹ˆë‹¤!)",
                msg_perfect_job: "Correct! (ì •ë‹µ!)",
            }
        };
        // Default fallback
        translations.ja = translations.zh; 
        translations.ms = translations.zh;
        translations.id = translations.zh;

        let currentLang = 'zh';

        function updateLanguage() {
            const lang = document.getElementById('langSelect').value;
            currentLang = lang;
            const t = translations[lang];
            
            document.querySelector('[data-i18n="instructions_title"]').innerHTML = t.instructions_title;
            document.querySelector('[data-i18n="instructions_list"]').innerHTML = t.instructions_list;
            
            // Only update buttons if not in "Next" state to avoid overwriting logic text
            const btnPerfect = document.getElementById('btn-perfect');
            if(!btnPerfect.classList.contains('hidden')) btnPerfect.textContent = t.btn_perfect;
            
            const btnNext = document.getElementById('btn-next');
            if(!btnNext.classList.contains('hidden')) btnNext.textContent = t.btn_next;
        }
        document.getElementById('langSelect').addEventListener('change', updateLanguage);

        // --- GAME LOGIC ---
        const canvas = document.getElementById('penCanvas');
        const rc = rough.canvas(canvas);
        let gameState = {
            a: 0, b: 0, c: 0,
            steps: [], // { latex: string, isError: boolean, errorType: string }
            hasError: false,
            errorLineIndex: -1,
            completed: false,
            score: 0,
            total: 0
        };

        function resizeCanvas() {
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = canvas.parentElement.offsetHeight;
        }
        window.addEventListener('resize', resizeCanvas);

        document.getElementById('today-date').textContent = new Date().toLocaleDateString();

        function generateProblem() {
            // 1. Generate Solvable Problem
            let a = Math.floor(Math.random() * 3) + 1; 
            if(Math.random()>0.5) a = -a;
            
            let b = Math.floor(Math.random() * 11) - 5; // -5 to 5
            let c = Math.floor(Math.random() * 11) - 5;
            
            // Ensure real roots for simplicity of auditing (discriminant >= 0)
            // or ensure perfect square for nicer numbers? Let's just ensure Real.
            while ((b*b - 4*a*c) < 0 || a === 0) {
                 b = Math.floor(Math.random() * 11) - 5;
                 c = Math.floor(Math.random() * 11) - 5;
            }

            gameState.a = a; gameState.b = b; gameState.c = c;
            
            // 2. Determine if Error exists (50/50 chance)
            gameState.hasError = Math.random() > 0.4; // 60% chance of error
            gameState.errorLineIndex = -1;
            gameState.completed = false;

            // Reset UI
            document.getElementById('work-steps').innerHTML = '';
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            document.getElementById('stamp-approved').classList.remove('visible');
            document.getElementById('stamp-rejected').classList.remove('visible');
            document.getElementById('btn-perfect').classList.remove('hidden');
            document.getElementById('btn-next').classList.add('hidden');
            document.getElementById('explanation-box').classList.add('hidden');
            document.getElementById('feedback-msg').textContent = translations[currentLang]?.msg_wait || "Waiting...";
            document.getElementById('feedback-msg').className = "text-white font-bold sketch-font text-xl mb-4 min-h-[3rem] flex items-center justify-center";

            // 3. Construct Steps
            const steps = [];
            
            // Step 0: The Equation (Not clickable really)
            const eqStr = formatPoly(a,b,c) + " = 0";
            document.getElementById('question-text').innerHTML = `$$ ${eqStr} $$`;

            // Step 1: Substitution
            // Correct: x = \frac{-b \pm \sqrt{b^2 - 4(a)(c)}}{2(a)}
            let subNum = -b;
            let subDisc = `${b}^2 - 4(${a})(${c})`;
            let subDenom = `2(${a})`;
            let errType = null;

            if (gameState.hasError && Math.random() < 0.33) {
                // Error: Forget to flip sign of b
                gameState.errorLineIndex = 0;
                subNum = b; 
                errType = "err_b_sign";
            } else if (gameState.hasError && Math.random() < 0.5) {
                // Error: Denom is just 2
                gameState.errorLineIndex = 0;
                subDenom = "2";
                errType = "err_denom";
            }
            
            steps.push({
                latex: `x = \\frac{${subNum} \\pm \\sqrt{${subDisc}}}{${subDenom}}`,
                isError: (gameState.errorLineIndex === 0),
                errType: errType
            });

            // Step 2: Simplify Discriminant contents
            let discVal = b*b - 4*a*c;
            let denomVal = 2*a;
            
            if (gameState.errorLineIndex === -1 && gameState.hasError && Math.random() < 0.6) {
                // Error: Sign error in -4ac
                gameState.errorLineIndex = 1;
                // Simulate calculating b^2 + 4ac instead
                discVal = b*b + 4*a*c; 
                errType = "err_disc_sign";
            }
            
            // Propagate previous errors if any
            if (gameState.errorLineIndex === 0 && steps[0].errType === 'err_denom') denomVal = 2;

            steps.push({
                latex: `x = \\frac{${subNum} \\pm \\sqrt{${discVal}}}{${denomVal}}`,
                isError: (gameState.errorLineIndex === 1),
                errType: errType
            });

            // Step 3: Final Answer (approx or exact)
            // Just show sqrt simplified if possible, or final decimal
            let final1, final2;
            
            if (gameState.errorLineIndex === -1 && gameState.hasError) {
                // Force an error in the final calculation step (Square root error or arithmetic)
                gameState.errorLineIndex = 2;
                // Fake roots
                final1 = (subNum + Math.sqrt(discVal) + 2).toFixed(2); // Random offset
                final2 = (subNum - Math.sqrt(discVal) + 2).toFixed(2);
                errType = "err_sqrt";
            } else {
                // Calculate based on whatever values we have (carrying forward previous errors or correct)
                if (discVal < 0) {
                    final1 = "No Real Roots";
                    final2 = "";
                } else {
                    final1 = ((subNum + Math.sqrt(discVal)) / denomVal).toFixed(2);
                    final2 = ((subNum - Math.sqrt(discVal)) / denomVal).toFixed(2);
                }
            }

            steps.push({
                latex: `x \\approx ${final1}, \\quad x \\approx ${final2}`,
                isError: (gameState.errorLineIndex === 2),
                errType: errType
            });

            gameState.steps = steps;
            renderSteps();
            renderMath();
            resizeCanvas();
        }

        function formatPoly(a, b, c) {
            let s = (a===1?'':(a===-1?'-':a)) + "x^2";
            s += (b>=0?'+':'-') + Math.abs(b) + "x";
            s += (c>=0?'+':'-') + Math.abs(c);
            return s;
        }

        function renderSteps() {
            const container = document.getElementById('work-steps');
            gameState.steps.forEach((step, index) => {
                const div = document.createElement('div');
                div.className = "step-row handwritten text-xl flex items-center gap-4";
                div.innerHTML = `<span class="text-slate-400 text-sm font-mono mt-1 select-none">${index+1}.</span> <span>$$ ${step.latex} $$</span>`;
                div.onclick = (e) => checkLine(index, e.currentTarget);
                container.appendChild(div);
            });
        }

        function checkLine(index, element) {
            if (gameState.completed) return;
            const t = translations[currentLang];
            const msg = document.getElementById('feedback-msg');

            const rect = element.getBoundingClientRect();
            const paperRect = document.getElementById('exam-paper').getBoundingClientRect();
            
            // Relative coords for canvas
            const x = 20; 
            const y = rect.top - paperRect.top + rect.height/2;
            const w = rect.width - 40;

            if (gameState.steps[index].isError) {
                // CORRECTLY IDENTIFIED ERROR
                gameState.completed = true;
                gameState.score++;
                
                // Draw Red Circle
                rc.ellipse(paperRect.width/2, y, paperRect.width - 40, rect.height + 10, {
                    stroke: '#dc2626', strokeWidth: 3, roughness: 2
                });
                
                // Feedback
                msg.textContent = t.msg_correct_spot;
                msg.className = "text-emerald-400 font-bold sketch-font text-xl mb-4 min-h-[3rem] flex items-center justify-center";
                
                document.getElementById('stamp-rejected').classList.add('visible');
                showNext();
                showExplanation(gameState.steps[index].errType);

            } else {
                // FALSE ALARM
                // Draw Green Check (to show it's okay)
                rc.path(`M${paperRect.width - 50} ${y-10} L${paperRect.width - 40} ${y+5} L${paperRect.width - 20} ${y-20}`, {
                    stroke: '#16a34a', strokeWidth: 3
                });

                msg.textContent = t.msg_false_alarm;
                msg.className = "text-amber-400 font-bold sketch-font text-xl mb-4 min-h-[3rem] flex items-center justify-center";
                // Don't end game, let them keep looking
            }
        }

        document.getElementById('btn-perfect').addEventListener('click', () => {
            if (gameState.completed) return;
            const t = translations[currentLang];
            const msg = document.getElementById('feedback-msg');

            if (!gameState.hasError) {
                // CORRECT: It was perfect
                gameState.completed = true;
                gameState.score++;
                
                document.getElementById('stamp-approved').classList.add('visible');
                msg.textContent = t.msg_perfect_job;
                msg.className = "text-emerald-400 font-bold sketch-font text-xl mb-4 min-h-[3rem] flex items-center justify-center";
                
                // Draw Big Green Tick over whole paper
                const p = document.getElementById('exam-paper');
                rc.path(`M${p.offsetWidth/2 - 50} ${p.offsetHeight/2} L${p.offsetWidth/2} ${p.offsetHeight/2 + 50} L${p.offsetWidth/2 + 100} ${p.offsetHeight/2 - 100}`, {
                    stroke: 'rgba(22, 163, 74, 0.2)', strokeWidth: 10, roughness: 3
                });

            } else {
                // WRONG: There was an error
                gameState.completed = true;
                msg.textContent = t.msg_missed_error;
                msg.className = "text-red-400 font-bold sketch-font text-xl mb-4 min-h-[3rem] flex items-center justify-center";
                
                // Highlight where the error was
                const rows = document.querySelectorAll('.step-row');
                const row = rows[gameState.errorLineIndex];
                const rect = row.getBoundingClientRect();
                const paperRect = document.getElementById('exam-paper').getBoundingClientRect();
                const y = rect.top - paperRect.top + rect.height/2;
                
                rc.ellipse(paperRect.width/2, y, paperRect.width - 40, rect.height + 10, {
                    stroke: '#dc2626', strokeWidth: 3, roughness: 2, strokeLineDash: [5,5]
                });
                
                showExplanation(gameState.steps[gameState.errorLineIndex].errType);
            }
            showNext();
        });

        function showExplanation(errCode) {
            const t = translations[currentLang];
            const box = document.getElementById('explanation-box');
            const txt = document.getElementById('explanation-text');
            
            let expl = t[errCode] || "Calculation Error.";
            txt.textContent = expl;
            box.classList.remove('hidden');
        }

        function showNext() {
            gameState.total++;
            document.getElementById('score-display').textContent = `${gameState.score}/${gameState.total}`;
            document.getElementById('btn-perfect').classList.add('hidden');
            document.getElementById('btn-next').classList.remove('hidden');
        }

        document.getElementById('btn-next').addEventListener('click', generateProblem);

        // Init
        updateLanguage();
        setTimeout(generateProblem, 100);

    </script>

      
      </div>

    </div>
  </section>

  <!-- FOOTER -->
  <footer class="bg-white border-t py-6 mt-12">
    <div class="max-w-6xl mx-auto px-6 text-center text-gray-500">
      Â© 2026 MathGems â€” Interactive Math Tools
    </div>
  </footer>

  <!-- MOBILE MENU SCRIPT -->
  <script>
    const menuBtn = document.getElementById('menuBtn');
    const mobileMenu = document.getElementById('mobileMenu');

    menuBtn.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });
  </script>

</body>
</html>

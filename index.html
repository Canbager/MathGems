<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MathGems ‚Äî Interactive Math Tools</title>

  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>

<body class="bg-gray-50 text-gray-800">

  <!-- NAVBAR -->
  <header class="bg-white shadow-sm">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <img src="img/mathgems_logo.jpeg" alt="Math Gems logo" style="height:6.5rem" class="w-auto mb-6 md:mb-0">
        <span class="text-2xl font-bold text-gray-900">
          Math<span class="text-blue-600">Gems</span>
        </span>
      </div>

      <nav class="hidden md:flex space-x-6">
        <a href="index.html" class="text-gray-700 hover:text-blue-600">Home</a>
    </div>

    <button id="menuBtn" class="md:hidden focus:outline-none px-6 py-4">
      <svg class="w-7 h-7 text-gray-700" fill="none" stroke="currentColor" stroke-width="2"
           viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
        <path d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </button>

    <nav id="mobileMenu"
         class="md:hidden hidden flex-col bg-white border-t border-gray-200 px-6 py-4 space-y-4">
      <a href="index.html" class="block text-blue-600 font-semibold">Home</a>
    </nav>
  </header>

  <!-- HERO SECTION -->
  <section class="max-w-5xl mx-auto px-6 pt-20 pb-6">
    <div class="flex flex-col md:flex-row items-center md:items-start md:space-x-8">
      <div class="text-center md:text-left">
    <h1 class="text-5xl font-bold mb-4 leading-tight">
      Interactive Math Tools for Curious Learners
    </h1>

    <p class="text-gray-600 text-lg max-w-2xl">
      MathGems brings concepts to life with visual, hands‚Äëon tools designed to deepen understanding.
      Explore algebra, number, geometry, and more ‚Äî all through interactive experiences.
    </p>

    <h2 class="text-2xl font-bold text-blue-600 mt-8 mb-2 leading-tight">
      Jump into a Topic
    </h2>

    <p class="text-gray-600 text-lg max-w-2xl">
      Choose a topic, then dive into subtopics and interactive tools.
    </p>
    </div>
      <img src="img/mathgems_logo_grey.png" alt="Math Gems logo" style="height:23.5rem" class="w-auto mb-6 md:mb-0">
    </div>
  </section>

  <!-- INLINE BROWSER -->
  <section id="browser" class="max-w-5xl mx-auto px-6 pb-20">
    
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- LEFT COLUMN -->
      <aside class="lg:w-1/4 bg-white rounded-xl shadow p-4 space-y-4">
        <a id="homeBackButton"
           href="#"
           class="block text-blue-600 font-semibold mb-2 hidden">
          ‚Üê Return to subtopics
        </a>
        <div id="homeTopicList" class="space-y-2"></div>
      </aside>

      <!-- RIGHT PANEL -->
      <main class="lg:w-3/4">
        <h3 id="homePanelTitle" class="text-2xl font-bold mb-6"></h3>
        <div id="homePanelGrid" class="grid gap-8 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4"></div>
      </main>
    </div>
  </section>

  <!-- ABOUT SECTION -->
  <section id="about" class="max-w-5xl mx-auto px-6 py-16">
    <h2 class="text-3xl font-bold text-center mb-8">Why MathGems?</h2>

    <div class="grid gap-10 md:grid-cols-3 text-center">
      <div>
        <div class="text-blue-600 text-4xl mb-3">üí†</div>
        <h3 class="font-semibold text-lg mb-2">Interactive Learning</h3>
        <p class="text-gray-600 text-sm">
          Students explore concepts through hands‚Äëon tools that make abstract ideas concrete.
        </p>
      </div>

      <div>
        <div class="text-blue-600 text-4xl mb-3">üì±</div>
        <h3 class="font-semibold text-lg mb-2">Mobile‚ÄëFirst Design</h3>
        <p class="text-gray-600 text-sm">
          Every tool works beautifully on phones, tablets, and desktops.
        </p>
      </div>

      <div>
        <div class="text-blue-600 text-4xl mb-3">üìö</div>
        <h3 class="font-semibold text-lg mb-2">Curriculum‚ÄëAligned</h3>
        <p class="text-gray-600 text-sm">
          Designed to support real classroom learning across key math topics.
        </p>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="bg-white border-t py-6 mt-12">
    <div class="max-w-6xl mx-auto px-6 text-center text-gray-500">
      ¬© 2026 MathGems ‚Äî Interactive Math Tools
    </div>
  </footer>

  <script>
    // MOBILE MENU
    const menuBtn = document.getElementById('menuBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    menuBtn.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });

    // INLINE BROWSER LOGIC
    let homeTopics = [];
    let homeCurrentTopic = null;
    let homeCurrentSubtopic = null;

    fetch('apps.json')
      .then(r => r.json())
      .then(data => {
        homeTopics = data.topics || [];
        if (homeTopics.length === 0) return;

        // NEW: Check URL params before deciding what to render
        checkUrlParams();
      });

    function checkUrlParams() {
      const urlParams = new URLSearchParams(window.location.search);
      const paramTopicId = urlParams.get('topic');
      const paramSubId = urlParams.get('subtopic');

      // 1. Try to find the requested topic
      if (paramTopicId) {
        const foundTopic = homeTopics.find(t => t.id === paramTopicId);
        if (foundTopic) {
          homeCurrentTopic = foundTopic;
          
          // 2. If topic found, try to find the requested subtopic
          if (paramSubId) {
            const foundSub = foundTopic.subtopics.find(s => s.id === paramSubId);
            if (foundSub) {
              homeCurrentSubtopic = foundSub;
              // Render the specific subtopic view directly
              renderHomeSubtopicMode();
              
              // Scroll to the browser section so the user sees it immediately
              document.getElementById('browser').scrollIntoView({ behavior: 'smooth' });
              return;
            }
          }
          // If topic found but no subtopic (or invalid subtopic), render topic view
          renderHomeTopicMode();
          document.getElementById('browser').scrollIntoView({ behavior: 'smooth' });
          return;
        }
      }

      // 3. Fallback: Default to the first topic if no params or invalid params
      homeCurrentTopic = homeTopics[0];
      homeCurrentSubtopic = null;
      renderHomeTopicMode();
    }

    function renderHomeTopicMode() {
      const list = document.getElementById('homeTopicList');
      const back = document.getElementById('homeBackButton');
      const titleEl = document.getElementById('homePanelTitle');
      const grid = document.getElementById('homePanelGrid');

      back.classList.add('hidden');
      list.innerHTML = '';
      grid.innerHTML = '';

      homeTopics.forEach(topic => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className =
          'w-full text-left px-3 py-2 rounded hover:bg-gray-100 ' +
          (homeCurrentTopic.id === topic.id ? 'bg-blue-100 font-semibold' : '');
        btn.textContent = topic.name;
        btn.addEventListener('click', () => {
          homeCurrentTopic = topic;
          homeCurrentSubtopic = null;
          // Clear URL params when switching topics manually so the URL stays clean
          window.history.replaceState(null, '', window.location.pathname); 
          renderHomeTopicMode();
        });
        list.appendChild(btn);
      });

      titleEl.textContent = homeCurrentTopic.name;

      homeCurrentTopic.subtopics.forEach(subtopic => {
        const card = document.createElement('button');
        card.type = 'button';
        card.className = 'text-left block bg-white rounded-xl shadow hover:shadow-lg transition p-6';
        card.innerHTML = `
          <h4 class="text-xl font-bold mb-2">${subtopic.name}</h4>
          <p class="text-gray-600">${subtopic.apps.length} apps</p>
        `;
        card.addEventListener('click', () => {
          homeCurrentSubtopic = subtopic;
          renderHomeSubtopicMode();
        });
        grid.appendChild(card);
      });
    }

    function renderHomeSubtopicMode() {
      const list = document.getElementById('homeTopicList');
      const back = document.getElementById('homeBackButton');
      const titleEl = document.getElementById('homePanelTitle');
      const grid = document.getElementById('homePanelGrid');

      back.classList.remove('hidden');
      back.onclick = (e) => {
        e.preventDefault();
        homeCurrentSubtopic = null;
        // Clear params on back
        window.history.replaceState(null, '', window.location.pathname);
        renderHomeTopicMode();
      };

      list.innerHTML = '';
      grid.innerHTML = '';

      const heading = document.createElement('div');
      heading.className = 'text-sm font-semibold text-gray-500 px-3 pb-2';
      heading.textContent = homeCurrentTopic.name;
      list.appendChild(heading);

      homeCurrentTopic.subtopics.forEach(subtopic => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className =
          'w-full text-left px-3 py-2 rounded hover:bg-gray-100 ' +
          (homeCurrentSubtopic.id === subtopic.id ? 'bg-blue-100 font-semibold' : '');
        btn.textContent = subtopic.name;
        btn.addEventListener('click', () => {
          homeCurrentSubtopic = subtopic;
          renderHomeSubtopicMode();
        });
        list.appendChild(btn);
      });

      titleEl.textContent = homeCurrentSubtopic.name;

      homeCurrentSubtopic.apps.forEach(app => {
        const card = document.createElement('a');
        // Ensure we pass the topic/subtopic IDs so the next page knows where it came from
        card.href =
          app.path +
          '?topic=' + encodeURIComponent(homeCurrentTopic.id) +
          '&subtopic=' + encodeURIComponent(homeCurrentSubtopic.id);

        card.className = 'block bg-white rounded-xl shadow hover:shadow-lg transition overflow-hidden';

        card.innerHTML = `
          <div class="h-48 flex items-center justify-center bg-gray-100">
            <img src="${app.preview}" class="max-h-full object-contain" alt="${app.title} preview">
          </div>
          <div class="p-5">
            <h4 class="text-lg font-bold mb-2">${app.title}</h4>
            <p class="text-gray-600 text-sm">${app.description}</p>
          </div>
        `;

        grid.appendChild(card);
      });
    }
  </script>

</body>
</html>
